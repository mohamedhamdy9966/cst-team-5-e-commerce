<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        overflow-x: hidden;
      }
      .sidebar {
        background-color: #036280;
        color: white;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 400px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        z-index: 1000;
      }
      .sidebar .nav-link {
        color: black;
        background-color: #0f84a9;
        margin: 20px auto;
        text-align: center;
        width: 50%;
        border-radius: 20px;
        font-size: 1.25rem;
        padding: 10px 20px;
      }
      .sidebar .nav-link:hover {
        background-color: #0c6c8a;
        box-shadow: 4px 4px 4px 4px rgba(36, 19, 194, 0.3);
      }
      .main-content {
        margin-left: 400px;
        padding: 2rem;
      }
      .header {
        background: white;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        position: sticky;
        top: 0;
        z-index: 999;
        text-align: center;
      }
      .user-table td,
      .user-table th {
        vertical-align: middle;
        text-align: center;
      }
      @media (max-width: 1281px) {
        .sidebar {
          width: 330px;
        }

        .main-content {
          margin-left: 300px;
        }

        .table {
          font-size: 0.8rem;
        }
      }
      @media (max-width: 768px) {
        .sidebar {
          flex-direction: row;
          justify-content: space-around;
          width: 100%;
          height: auto;
          position: fixed;
          top: 0;
          left: 0;
          padding: 0.5rem;
        }

        .sidebar span {
          display: none;
        }

        .sidebar .nav-link {
          margin: 0;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .main-content {
          margin-left: 0 !important;
          padding-top: 5rem;
        }

        .user-table {
          font-size: 0.7rem;
        }

        .user-table i {
          font-size: 8px;
        }

        @media (max-width: 380px) {
          #gg {
            font-size: 0.5rem;
          }
        }
      }
      h5[class="modal-title"] {
        color: #036280;
      }
      button[type="submit"] {
        background-color: #036280;
        color: white;
      }
      button[type="submit"]:hover {
        background-color: #f4c430;
        color: white;
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <nav class="sidebar">
      <a href="./adminDashboard.html" class="nav-link ff15" title="Add Items"
        ><i class="bi bi-plus-square"></i><span> Book</span></a
      >
      <a href="./adminBookList.html" class="nav-link" title="List Items"
        ><i class="bi bi-list-ul"></i><span> Book list</span></a
      >
      <a href="./adminOrders.html" class="nav-link" title="Orders"
        ><i class="bi bi-receipt"></i><span> Orders</span></a
      >
      <a href="./adminUsers.html" class="nav-link" title="Users"
        ><i class="bi bi-people"></i><span> Users</span></a
      >
      <a href="./adminCustomerService.html" class="nav-link" title="Users"
        ><i class="bi bi-people"></i><span> Customer Services</span></a
      >
      <a href="#" class="nav-link" title="Logout" onclick="logout()"
        ><i class="bi bi-box-arrow-right"></i><span> LogOut</span></a
      >
    </nav>
    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h3>All Users</h3>
      </div>
      <div class="user-list-container mt-4">
        <table class="table table-striped user-table" id="gg">
          <thead class="table-light">
            <tr>
              <th>UserName</th>
              <th>Email</th>
              <th>User Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>
    <section
      class="modal fade"
      id="editUserModal"
      tabindex="-1"
      aria-labelledby="editUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="editForm">
            <div class="modal-header">
              <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="editIndex" />
              <div class="mb-3">
                <label for="editFname" class="form-label">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="editFname"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editEmail" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="editEmail"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editRole" class="form-label">Role</label>
                <select class="form-select" id="editRole" required>
                  <option value="admin">Admin</option>
                  <option value="seller">Seller</option>
                  <option value="user">User</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>
    <script>
      const users = JSON.parse(localStorage.getItem("users")) || [];
      if (users.length === 0) {
        const dummyUsers = [
          {
            fname: "admin",
            lname: "admin",
            email: "admin@iti.com",
            role: "admin",
          },
          {
            fname: "seller",
            lname: "seller",
            email: "seller@iti.com",
            role: "seller",
          },
          {
            fname: "customer",
            lname: "customer",
            email: "customer@iti.com",
            role: "admin",
          },
        ];
        localStorage.setItem("users", JSON.stringify(dummyUsers));
        location.reload();
      }
      const tbody = document.querySelector("tbody");
      tbody.innerHTML = "";
      users.forEach((user, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${user.fname + " " + user.lname}</td>
        <td>${user.email}</td>
        <td>${user.role}</td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="editUser(${index})">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-sm" onclick="deleteUser(${index})">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      `;
        tbody.appendChild(row);
      });
      function deleteUser(index) {
        if (users[index].role === "admin") {
          alert("Cannot delete the admin account.");
          return;
        }
        if (confirm("Are you sure you want to delete this user?")) {
          users.splice(index, 1);
          localStorage.setItem("users", JSON.stringify(users));
          location.reload();
        }
      }
      function editUser(index) {
        const user = users[index];
        if (user.role === "admin") {
          alert("Cannot edit the admin account.");
          return;
        }
        document.getElementById("editIndex").value = index;
        document.getElementById("editFname").value =
          user.fname || user.firstname;
        document.getElementById("editEmail").value = user.email;
        document.getElementById("editRole").value = user.role;
        const modal = new bootstrap.Modal(
          document.getElementById("editUserModal")
        );
        modal.show();
      }
      document
        .getElementById("editForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const index = document.getElementById("editIndex").value;
          const fname = document.getElementById("editFname").value.trim();
          const email = document.getElementById("editEmail").value.trim();
          const role = document.getElementById("editRole").value;
          if (!fname || !email || !role) {
            alert("All fields are required.");
            return;
          }
          users[index].fname = fname;
          users[index].email = email;
          users[index].role = role;
          localStorage.setItem("users", JSON.stringify(users));
          alert("User updated successfully!");
          location.reload();
        });
    </script>
  </body>
</html>
